#!/usr/bin/env node
"use strict";var e=require("commander"),r=require("node:path"),t=require("fast-xml-parser"),n=require("node:fs/promises"),o=new e.Command;function a(e,r,t,n){return new(t||(t=Promise))((function(o,a){function c(e){try{i(n.next(e))}catch(e){a(e)}}function s(e){try{i(n.throw(e))}catch(e){a(e)}}function i(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(c,s)}i((n=n.apply(e,r||[])).next())}))}function c(e,r){var t,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=s(0),c.throw=s(1),c.return=s(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(s){return function(i){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;c&&(c=0,s[0]&&(a=0)),a;)try{if(t=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=r.call(e,a)}catch(e){s=[6,e],n=0}finally{t=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function s(e,r,t){if(t||2===arguments.length)for(var n,o=0,a=r.length;o<a;o++)!n&&o in r||(n||(n=Array.prototype.slice.call(r,0,o)),n[o]=r[o]);return e.concat(n||Array.prototype.slice.call(r))}o.name("svg-creator").option("-c, --colorful","svg彩色",!1).option("-O, --allow-override","允许覆盖",!1).option("--prefix [string]","组件前缀").option("-t, --type <filepath>","类型输出位置（文件）").option("-s, --src <dirname>","svg源目录").option("-d, --dest <dirname>","组件输出目录"),"function"==typeof SuppressedError&&SuppressedError;var i=process.cwd(),l=["viewBox"].map((function(e){return"".concat("@_").concat(e)})),u=["svg","circle","ellipse","rect","line","polyline","polygon","path","text","tspan","g","defs","use","linearGradient","pattern","mask","clipPath","filter"],p={ignoreAttributes:!1};function f(e){return a(this,void 0,void 0,(function(){var t,o,a,s;return c(this,(function(c){switch(c.label){case 0:return e.type?(t=r.resolve(i,e.type),[4,n.mkdir(r.resolve(t,".."),{recursive:!0})]):[2];case 1:return c.sent(),o=r.resolve(i,e.dest),[4,n.readdir(o)];case 2:return a=c.sent(),s="// 自动生成文件，请勿修改\ndeclare module '@vue/runtime-core' {\n  export interface GlobalComponents {\n    ".concat(a.map((function(t){var n=r.parse(t).name.replace(/(^\S|-\S)/g,(function(e){return e.toUpperCase()})).replace(/-/g,""),o=r.join(e.dest,t).replace(/\\/g,"/").replace(/^src\//,"@/");return[n,"typeof import('".concat(o,"')")].join(": ")})).join("\n    "),"\n  }\n}\n\nexport {}"),[4,n.writeFile(t,s)];case 3:return c.sent(),[2]}}))}))}!function(e){a(this,void 0,void 0,(function(){var o,a,v,d,h,m,y,b,g,w,x,k,j,S,O;return c(this,(function(q){switch(q.label){case 0:return o=r.resolve(i,e.dest),a=new t.XMLParser(p),v=new t.XMLBuilder(p),d=r.resolve(i,e.src),[4,n.readdir(d)];case 1:return h=q.sent(),m=[],y=s(s([],l,!0),u,!0),[4,n.mkdir(o,{recursive:!0})];case 2:q.sent(),b=function(t){var o,s,i,l,u,p;return c(this,(function(c){switch(c.label){case 0:return o=r.resolve(d,t),".svg"!==(s=r.parse(o)).ext?[2,"break"]:[4,n.readFile(o)];case 1:return i=c.sent(),l=a.parse(i),u={},Object.keys(l.svg).forEach((function(e){y.includes(e)&&Reflect.set(u,e,l.svg[e])})),u["".concat("@_","class")]="iconfont-svg",p=v.build({template:{svg:u}}),e.colorful||(p=p.replace(/ fill="[^"]*"/g,' fill="currentColor"')),m.push({template:p,filename:"".concat(e.prefix).concat(s.name,".vue")}),[2]}}))},g=0,w=h,q.label=3;case 3:return g<w.length?(x=w[g],[5,b(x)]):[3,6];case 4:if("break"===q.sent())return[3,6];q.label=5;case 5:return g++,[3,3];case 6:k=0,j=m,q.label=7;case 7:return k<j.length?(S=j[k],O=r.resolve(o,S.filename),e.allowOverride?[4,n.writeFile(O,S.template)]:[3,9]):[3,14];case 8:return q.sent(),[3,13];case 9:return q.trys.push([9,11,,13]),[4,n.access(O)];case 10:return q.sent(),console.log("".concat(S.filename,"已存在，跳过")),[3,13];case 11:return q.sent(),[4,n.writeFile(O,S.template)];case 12:return q.sent(),[3,13];case 13:return k++,[3,7];case 14:return[4,f(e)];case 15:return q.sent(),[2]}}))}))}(o.parse(process.argv).opts());
